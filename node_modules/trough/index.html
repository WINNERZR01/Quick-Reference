<!doctype html>
<html lang="en" data-color-mode="dark">
<head>
<meta charset="utf-8">
<title># trough

[![Build][build-badge]][build]
[![Coverage][coverage-badge]][coverage]
[![Downloads][downloads-badge]][downloads]
[![Size][size-badge]][size]

`trough` is middleware.

## Contents

*   [What is this?](#what-is-this)
*   [When should I use this?](#when-should-i-use-this)
*   [Install](#install)
*   [Use](#use)
*   [API](#api)
    *   [`trough()`](#trough-1)
    *   [`wrap(middleware, callback)(…input)`](#wrapmiddleware-callbackinput)
    *   [`Trough`](#trough-2)
*   [Types](#types)
*   [Compatibility](#compatibility)
*   [Security](#security)
*   [Contribute](#contribute)
*   [License](#license)

## What is this?

`trough` is like [`ware`][ware] with less sugar.
Middleware functions can also change the input of the next.

The word **trough** (`/trôf/`) means a channel used to convey a liquid.

## When should I use this?

You can use this package when you’re building something that accepts “plugins”,
which are functions, that can be sync or async, promises or callbacks.

## Install

This package is [ESM only][esm].
In Node.js (version 12.20+, 14.14+, or 16.0+), install with [npm][]:

```sh
npm install trough
```

In Deno with [`esm.sh`][esmsh]:

```js
import {trough} from "https://esm.sh/trough@2"
```

In browsers with [`esm.sh`][esmsh]:

```html
&#x3C;script type &#x26;  index cheatsheet &#x26;  Quick Reference</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta description="为开发人员分享快速参考备忘单。">
<meta keywords="Quick,Reference,cheatsheet,index">
<link rel="icon" href="data:image/svg+xml,%3Csvg%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20height%3D%221em%22%20width%3D%221em%22%3E%20%3Cpath%20d%3D%22m21.66%2010.44-.98%204.18c-.84%203.61-2.5%205.07-5.62%204.77-.5-.04-1.04-.13-1.62-.27l-1.68-.4c-4.17-.99-5.46-3.05-4.48-7.23l.98-4.19c.2-.85.44-1.59.74-2.2%201.17-2.42%203.16-3.07%206.5-2.28l1.67.39c4.19.98%205.47%203.05%204.49%207.23Z%22%20fill%3D%22%23c9d1d9%22%2F%3E%20%3Cpath%20d%3D%22M15.06%2019.39c-.62.42-1.4.77-2.35%201.08l-1.58.52c-3.97%201.28-6.06.21-7.35-3.76L2.5%2013.28c-1.28-3.97-.22-6.07%203.75-7.35l1.58-.52c.41-.13.8-.24%201.17-.31-.3.61-.54%201.35-.74%202.2l-.98%204.19c-.98%204.18.31%206.24%204.48%207.23l1.68.4c.58.14%201.12.23%201.62.27Zm2.43-8.88c-.06%200-.12-.01-.19-.02l-4.85-1.23a.75.75%200%200%201%20.37-1.45l4.85%201.23a.748.748%200%200%201-.18%201.47Z%22%20fill%3D%22%23228e6c%22%20%2F%3E%20%3Cpath%20d%3D%22M14.56%2013.89c-.06%200-.12-.01-.19-.02l-2.91-.74a.75.75%200%200%201%20.37-1.45l2.91.74c.4.1.64.51.54.91-.08.34-.38.56-.72.56Z%22%20fill%3D%22%23228e6c%22%20%2F%3E%20%3C%2Fsvg%3E" type="image/svg+xml">
<link rel="stylesheet" href="..\..\style\style.css">
<link rel="stylesheet" href="..\..\style\katex.css">
</head>
<body><nav class="header-nav"><div class="max-container"><a href="..\..\index.html" class="logo"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" height="1em" width="1em">
  <path d="m21.66 10.44-.98 4.18c-.84 3.61-2.5 5.07-5.62 4.77-.5-.04-1.04-.13-1.62-.27l-1.68-.4c-4.17-.99-5.46-3.05-4.48-7.23l.98-4.19c.2-.85.44-1.59.74-2.2 1.17-2.42 3.16-3.07 6.5-2.28l1.67.39c4.19.98 5.47 3.05 4.49 7.23Z" fill="#c9d1d9"></path>
  <path d="M15.06 19.39c-.62.42-1.4.77-2.35 1.08l-1.58.52c-3.97 1.28-6.06.21-7.35-3.76L2.5 13.28c-1.28-3.97-.22-6.07 3.75-7.35l1.58-.52c.41-.13.8-.24 1.17-.31-.3.61-.54 1.35-.74 2.2l-.98 4.19c-.98 4.18.31 6.24 4.48 7.23l1.68.4c.58.14 1.12.23 1.62.27Zm2.43-8.88c-.06 0-.12-.01-.19-.02l-4.85-1.23a.75.75 0 0 1 .37-1.45l4.85 1.23a.748.748 0 0 1-.18 1.47Z" fill="#228e6c"></path>
  <path d="M14.56 13.89c-.06 0-.12-.01-.19-.02l-2.91-.74a.75.75 0 0 1 .37-1.45l2.91.74c.4.1.64.51.54.91-.08.34-.38.56-.72.56Z" fill="#228e6c"></path>
</svg>
<span class="title">Quick Reference</span></a><div class="menu"><a href="https://github.com/jaywcjlove/reference/blob/main/node_modules/trough\readme.md" class="" target="__blank"><svg viewBox="0 0 36 36" fill="currentColor" height="1em" width="1em"><path d="m33 6.4-3.7-3.7a1.71 1.71 0 0 0-2.36 0L23.65 6H6a2 2 0 0 0-2 2v22a2 2 0 0 0 2 2h22a2 2 0 0 0 2-2V11.76l3-3a1.67 1.67 0 0 0 0-2.36ZM18.83 20.13l-4.19.93 1-4.15 9.55-9.57 3.23 3.23ZM29.5 9.43 26.27 6.2l1.85-1.85 3.23 3.23Z"></path><path fill="none" d="M0 0h36v36H0z"></path></svg><span>编辑</span></a><button id="darkMode" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="light" height="1em" width="1em">
  <path d="M6.995 12c0 2.761 2.246 5.007 5.007 5.007s5.007-2.246 5.007-5.007-2.246-5.007-5.007-5.007S6.995 9.239 6.995 12zM11 19h2v3h-2zm0-17h2v3h-2zm-9 9h3v2H2zm17 0h3v2h-3zM5.637 19.778l-1.414-1.414 2.121-2.121 1.414 1.414zM16.242 6.344l2.122-2.122 1.414 1.414-2.122 2.122zM6.344 7.759 4.223 5.637l1.415-1.414 2.12 2.122zm13.434 10.605-1.414 1.414-2.122-2.122 1.414-1.414z"></path>
</svg>
<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" class="dark" height="1em" width="1em">
  <path d="M12 11.807A9.002 9.002 0 0 1 10.049 2a9.942 9.942 0 0 0-5.12 2.735c-3.905 3.905-3.905 10.237 0 14.142 3.906 3.906 10.237 3.905 14.143 0a9.946 9.946 0 0 0 2.735-5.119A9.003 9.003 0 0 1 12 11.807z"></path>
</svg>
</button><script>
  const LOCAL_NANE = '_dark_mode_theme_'
  const rememberedValue = localStorage.getItem(LOCAL_NANE);
  if (rememberedValue && ['light', 'dark'].includes(rememberedValue)) {
    document.documentElement.setAttribute('data-color-mode', rememberedValue);
  }
  const button = document.querySelector('#darkMode');
  button.onclick = () => {
    const theme = document.documentElement.dataset.colorMode;
    const mode = theme === 'light' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-color-mode', mode);
    localStorage.setItem(LOCAL_NANE, mode);
  }
</script><a href="https://github.com/jaywcjlove/reference" class="" target="__blank"><svg viewBox="0 0 16 16" fill="currentColor" height="1em" width="1em"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a></div></div></nav><div class="wrap h1body-exist max-container"><header class="wrap-header h1wrap"><h1 id="trough"><a aria-hidden="true" tabindex="-1" href="#trough"><span class="icon icon-link"></span></a>trough</h1><div class="wrap-body">
<p><a href="https://github.com/wooorm/trough/actions"><img src="https://github.com/wooorm/trough/workflows/main/badge.svg" alt="Build"></a>
<a href="https://codecov.io/github/wooorm/trough"><img src="https://img.shields.io/codecov/c/github/wooorm/trough.svg" alt="Coverage"></a>
<a href="https://www.npmjs.com/package/trough"><img src="https://img.shields.io/npm/dm/trough.svg" alt="Downloads"></a>
<a href="https://bundlephobia.com/result?p=trough"><img src="https://img.shields.io/bundlephobia/minzip/trough.svg" alt="Size"></a></p>
<p><code>trough</code> is middleware.</p>
</div></header><div class="menu-tocs"><div class="menu-btn"><svg aria-hidden="true" fill="currentColor" height="1em" width="1em" viewBox="0 0 16 16" version="1.1" data-view-component="true">
  <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
</svg></div><div class="menu-modal"><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#contents">Contents</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#what-is-this">What is this?</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#when-should-i-use-this">When should I use this?</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#install">Install</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#use">Use</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#api">API</a><a aria-hidden="true" class="leve3 tocs-link" data-num="3" href="#trough-1">trough()</a><a aria-hidden="true" class="leve3 tocs-link" data-num="3" href="#wrapmiddleware-callbackinput">wrap(middleware, callback)(…input)</a><a aria-hidden="true" class="leve3 tocs-link" data-num="3" href="#trough-2">Trough</a><a aria-hidden="true" class="leve4 tocs-link" data-num="4" href="#troughruninput-done">Trough#run([input…, ]done)</a><a aria-hidden="true" class="leve5 tocs-link" data-num="5" href="#function-doneerr-output">function done(err?, [output…])</a><a aria-hidden="true" class="leve4 tocs-link" data-num="4" href="#troughusefn">Trough#use(fn)</a><a aria-hidden="true" class="leve5 tocs-link" data-num="5" href="#function-fninput-next">function fn([input…, ][next])</a><a aria-hidden="true" class="leve6 tocs-link" data-num="6" href="#synchronous">Synchronous</a><a aria-hidden="true" class="leve6 tocs-link" data-num="6" href="#promise">Promise</a><a aria-hidden="true" class="leve6 tocs-link" data-num="6" href="#asynchronous">Asynchronous</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#types">Types</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#compatibility">Compatibility</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#security">Security</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#contribute">Contribute</a><a aria-hidden="true" class="leve2 tocs-link" data-num="2" href="#license">License</a></div></div><div class="h1wrap-body"><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="contents"><a aria-hidden="true" tabindex="-1" href="#contents"><span class="icon icon-link"></span></a>Contents</h2><div class="wrap-body">
<ul>
<li><a href="#what-is-this">What is this?</a></li>
<li><a href="#when-should-i-use-this">When should I use this?</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#use">Use</a></li>
<li><a href="#api">API</a>
<ul>
<li><a href="#trough-1"><code>trough()</code></a></li>
<li><a href="#wrapmiddleware-callbackinput"><code>wrap(middleware, callback)(…input)</code></a></li>
<li><a href="#trough-2"><code>Trough</code></a></li>
</ul>
</li>
<li><a href="#types">Types</a></li>
<li><a href="#compatibility">Compatibility</a></li>
<li><a href="#security">Security</a></li>
<li><a href="#contribute">Contribute</a></li>
<li><a href="#license">License</a></li>
</ul>
</div></div><div class="h2wrap-body"></div></div><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="what-is-this"><a aria-hidden="true" tabindex="-1" href="#what-is-this"><span class="icon icon-link"></span></a>What is this?</h2><div class="wrap-body">
<p><code>trough</code> is like <a href="https://github.com/segmentio/ware"><code>ware</code></a> with less sugar.
Middleware functions can also change the input of the next.</p>
<p>The word <strong>trough</strong> (<code>/trôf/</code>) means a channel used to convey a liquid.</p>
</div></div><div class="h2wrap-body"></div></div><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="when-should-i-use-this"><a aria-hidden="true" tabindex="-1" href="#when-should-i-use-this"><span class="icon icon-link"></span></a>When should I use this?</h2><div class="wrap-body">
<p>You can use this package when you’re building something that accepts “plugins”,
which are functions, that can be sync or async, promises or callbacks.</p>
</div></div><div class="h2wrap-body"></div></div><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="install"><a aria-hidden="true" tabindex="-1" href="#install"><span class="icon icon-link"></span></a>Install</h2><div class="wrap-body">
<p>This package is <a href="https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c">ESM only</a>.
In Node.js (version 12.20+, 14.14+, or 16.0+), install with <a href="https://docs.npmjs.com/cli/install">npm</a>:</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line"><span class="token function">npm</span> <span class="token function">install</span> trough
</span></code></pre>
<p>In Deno with <a href="https://esm.sh"><code>esm.sh</code></a>:</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"https://esm.sh/trough@2"</span>
</span></code></pre>
<p>In browsers with <a href="https://esm.sh"><code>esm.sh</code></a>:</p>
<pre class="language-html"><code class="language-html code-highlight"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
</span></span></span><span class="code-line"><span class="token script"><span class="token language-javascript">  <span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"https://esm.sh/trough@2?bundle"</span>
</span></span></span><span class="code-line"><span class="token script"><span class="token language-javascript"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
</span></code></pre>
</div></div><div class="h2wrap-body"></div></div><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="use"><a aria-hidden="true" tabindex="-1" href="#use"><span class="icon icon-link"></span></a>Use</h2><div class="wrap-body">
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports">process</span> <span class="token keyword module">from</span> <span class="token string">'node:process'</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports">fs</span> <span class="token keyword module">from</span> <span class="token string">'node:fs'</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports">path</span> <span class="token keyword module">from</span> <span class="token string">'node:path'</span>
</span><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'trough'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> pipeline <span class="token operator">=</span> <span class="token function">trough</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Checking… '</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">filePath<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    fs<span class="token punctuation">.</span><span class="token method function property-access">stat</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">next</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token punctuation">{</span>filePath<span class="token punctuation">,</span> stats<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token property-access">stats</span><span class="token punctuation">.</span><span class="token method function property-access">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      fs<span class="token punctuation">.</span><span class="token method function property-access">readFile</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token property-access">filePath</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Expected file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">pipeline<span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'readme.md'</span><span class="token punctuation">,</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span>
</span><span class="code-line">pipeline<span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Yields:</p>
<pre class="language-txt"><code class="language-txt code-highlight"><span class="code-line">Checking… readme.md
</span><span class="code-line">Checking… node_modules
</span><span class="code-line">Error: Expected file
</span><span class="code-line">    at ~/example.js:22:12
</span><span class="code-line">    at wrapped (~/node_modules/trough/index.js:111:16)
</span><span class="code-line">    at next (~/node_modules/trough/index.js:62:23)
</span><span class="code-line">    at done (~/node_modules/trough/index.js:145:7)
</span><span class="code-line">    at ~/example.js:15:7
</span><span class="code-line">    at FSReqCallback.oncomplete (node:fs:199:5)
</span><span class="code-line">null &#x3C;Buffer 23 20 74 72 6f 75 67 68 0a 0a 5b 21 5b 42 75 69 6c 64 5d 5b 62 75 69 6c 64 2d 62 61 64 67 65 5d 5d 5b 62 75 69 6c 64 5d 0a 5b 21 5b 43 6f 76 65 72 61 ... 7994 more bytes>
</span></code></pre>
</div></div><div class="h2wrap-body"></div></div><div class="wrap h2body-exist"><div class="wrap-header h2wrap"><h2 id="api"><a aria-hidden="true" tabindex="-1" href="#api"><span class="icon icon-link"></span></a>API</h2><div class="wrap-body">
<p>This package exports the identifiers <code>trough</code> and <code>wrap</code>.
There is no default export.</p>
</div></div><div class="h2wrap-body"><div class="wrap h3body-not-exist"><div class="wrap-header h3wrap"><h3 id="trough-1"><a aria-hidden="true" tabindex="-1" href="#trough-1"><span class="icon icon-link"></span></a><code>trough()</code></h3><div class="wrap-body">
<p>Create a new <a href="#trough-1"><code>Trough</code></a>.</p>
</div></div></div><div class="wrap h3body-not-exist"><div class="wrap-header h3wrap"><h3 id="wrapmiddleware-callbackinput"><a aria-hidden="true" tabindex="-1" href="#wrapmiddleware-callbackinput"><span class="icon icon-link"></span></a><code>wrap(middleware, callback)(…input)</code></h3><div class="wrap-body">
<p>Call <code>middleware</code> with all input.
If <code>middleware</code> accepts more arguments than given in input, an extra <code>done</code>
function is passed in after the input when calling it.
In that case, <code>done</code> must be called.</p>
<p>The first value in <code>input</code> is the main input value.
All other input values are the rest input values.
The values given to <code>callback</code> are the input values, merged with every
non-nullish output value.</p>
<ul>
<li>If <code>middleware</code> throws an error, returns a promise that is rejected, or
calls the given <code>done</code> function with an error, <code>callback</code> is called with
that error</li>
<li>If <code>middleware</code> returns a value or returns a promise that is resolved, that
value is the main output value</li>
<li>If <code>middleware</code> calls <code>done</code>, all non-nullish values except for the first
one (the error) overwrite the output values</li>
</ul>
</div></div></div><div class="wrap h3body-exist"><div class="wrap-header h3wrap"><h3 id="trough-2"><a aria-hidden="true" tabindex="-1" href="#trough-2"><span class="icon icon-link"></span></a><code>Trough</code></h3><div class="wrap-body">
<p>A pipeline.</p>
<h4 id="troughruninput-done"><a aria-hidden="true" tabindex="-1" href="#troughruninput-done"><span class="icon icon-link"></span></a><code>Trough#run([input…, ]done)</code></h4>
<p>Run the pipeline (all <a href="#troughusefn"><code>use()</code></a>d middleware).
Calls <a href="#function-doneerr-output"><code>done</code></a> on completion with either an error or the output of the
last middleware.</p>
<blockquote>
<p>👉 <strong>Note</strong>: as the length of input defines whether <a href="#asynchronous">async</a> functions get a
<code>next</code> function, it’s recommended to keep <code>input</code> at one value normally.</p>
</blockquote>
<h5 id="function-doneerr-output"><a aria-hidden="true" tabindex="-1" href="#function-doneerr-output"><span class="icon icon-link"></span></a><code>function done(err?, [output…])</code></h5>
<p>The final handler passed to <a href="#troughruninput-done"><code>run()</code></a>, called with an error if a
<a href="#function-fninput-next">middleware function</a> rejected, passed, or threw one, or the output of the
last middleware function.</p>
<h4 id="troughusefn"><a aria-hidden="true" tabindex="-1" href="#troughusefn"><span class="icon icon-link"></span></a><code>Trough#use(fn)</code></h4>
<p>Add <code>fn</code>, a <a href="#function-fninput-next">middleware function</a>, to the pipeline.</p>
<h5 id="function-fninput-next"><a aria-hidden="true" tabindex="-1" href="#function-fninput-next"><span class="icon icon-link"></span></a><code>function fn([input…, ][next])</code></h5>
<p>A middleware function called with the output of its predecessor.</p>
<h6 id="synchronous"><a aria-hidden="true" tabindex="-1" href="#synchronous"><span class="icon icon-link"></span></a>Synchronous</h6>
<p>If <code>fn</code> returns or throws an error, the pipeline fails and <code>done</code> is called
with that error.</p>
<p>If <code>fn</code> returns a value (neither <code>null</code> nor <code>undefined</code>), the first <code>input</code> of
the next function is set to that value (all other <code>input</code> is passed through).</p>
<p>The following example shows how returning an error stops the pipeline:</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'trough'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">trough</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thing</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Got: '</span> <span class="token operator">+</span> thing<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'some value'</span><span class="token punctuation">,</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Yields:</p>
<pre class="language-txt"><code class="language-txt code-highlight"><span class="code-line">Error: Got: some value
</span><span class="code-line">    at ~/example.js:5:12
</span><span class="code-line">    …
</span></code></pre>
<p>The following example shows how throwing an error stops the pipeline:</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'trough'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">trough</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thing</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Got: '</span> <span class="token operator">+</span> thing<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'more value'</span><span class="token punctuation">,</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Yields:</p>
<pre class="language-txt"><code class="language-txt code-highlight"><span class="code-line">Error: Got: more value
</span><span class="code-line">    at ~/example.js:5:11
</span><span class="code-line">    …
</span></code></pre>
<p>The following example shows how the first output can be modified:</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'trough'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">trough</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thing</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token string">'even '</span> <span class="token operator">+</span> thing
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'more value'</span><span class="token punctuation">,</span> <span class="token string">'untouched'</span><span class="token punctuation">,</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Yields:</p>
<pre class="language-txt"><code class="language-txt code-highlight"><span class="code-line">null 'even more value' 'untouched'
</span></code></pre>
<h6 id="promise"><a aria-hidden="true" tabindex="-1" href="#promise"><span class="icon icon-link"></span></a>Promise</h6>
<p>If <code>fn</code> returns a promise, and that promise rejects, the pipeline fails and
<code>done</code> is called with the rejected value.</p>
<p>If <code>fn</code> returns a promise, and that promise resolves with a value (neither
<code>null</code> nor <code>undefined</code>), the first <code>input</code> of the next function is set to that
value (all other <code>input</code> is passed through).</p>
<p>The following example shows how rejecting a promise stops the pipeline:</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'trough'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">trough</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thing</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Got: '</span> <span class="token operator">+</span> thing<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'thing'</span><span class="token punctuation">,</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Yields:</p>
<pre class="language-txt"><code class="language-txt code-highlight"><span class="code-line">Got: thing
</span></code></pre>
<p>The following example shows how the input isn’t touched by resolving to <code>null</code>.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'trough'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">trough</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'Input'</span><span class="token punctuation">,</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Yields:</p>
<pre class="language-txt"><code class="language-txt code-highlight"><span class="code-line">null 'Input'
</span></code></pre>
<h6 id="asynchronous"><a aria-hidden="true" tabindex="-1" href="#asynchronous"><span class="icon icon-link"></span></a>Asynchronous</h6>
<p>If <code>fn</code> accepts one more argument than the given <code>input</code>, a <code>next</code> function is
given (after the input).  <code>next</code> must be called, but doesn’t have to be called
async.</p>
<p>If <code>next</code> is given a value (neither <code>null</code> nor <code>undefined</code>) as its first
argument, the pipeline fails and <code>done</code> is called with that value.</p>
<p>If <code>next</code> is given no value (either <code>null</code> or <code>undefined</code>) as the first
argument, all following non-nullish values change the input of the following
function, and all nullish values default to the <code>input</code>.</p>
<p>The following example shows how passing a first argument stops the pipeline:</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'trough'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">trough</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thing<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Got: '</span> <span class="token operator">+</span> thing<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'thing'</span><span class="token punctuation">,</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Yields:</p>
<pre class="language-txt"><code class="language-txt code-highlight"><span class="code-line">Error: Got: thing
</span><span class="code-line">    at ~/example.js:5:10
</span></code></pre>
<p>The following example shows how more values than the input are passed.</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span>trough<span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'trough'</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">trough</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thing<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token string">'values'</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token string">'some'</span><span class="token punctuation">,</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token property-access">log</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Yields:</p>
<pre class="language-txt"><code class="language-txt code-highlight"><span class="code-line">null 'some' 'values'
</span></code></pre>
</div></div></div></div></div><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="types"><a aria-hidden="true" tabindex="-1" href="#types"><span class="icon icon-link"></span></a>Types</h2><div class="wrap-body">
<p>This package is fully typed with <a href="https://www.typescriptlang.org">TypeScript</a>.</p>
</div></div><div class="h2wrap-body"></div></div><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="compatibility"><a aria-hidden="true" tabindex="-1" href="#compatibility"><span class="icon icon-link"></span></a>Compatibility</h2><div class="wrap-body">
<p>This package is at least compatible with all maintained versions of Node.js.
As of now, that is Node.js 12.20+, 14.14+, and 16.0+.
It also works in Deno and modern browsers.</p>
</div></div><div class="h2wrap-body"></div></div><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="security"><a aria-hidden="true" tabindex="-1" href="#security"><span class="icon icon-link"></span></a>Security</h2><div class="wrap-body">
<p>This package is safe.</p>
</div></div><div class="h2wrap-body"></div></div><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="contribute"><a aria-hidden="true" tabindex="-1" href="#contribute"><span class="icon icon-link"></span></a>Contribute</h2><div class="wrap-body">
<p>Yes please!
See <a href="https://opensource.guide/how-to-contribute/">How to Contribute to Open Source</a>.</p>
</div></div><div class="h2wrap-body"></div></div><div class="wrap h2body-not-exist"><div class="wrap-header h2wrap"><h2 id="license"><a aria-hidden="true" tabindex="-1" href="#license"><span class="icon icon-link"></span></a>License</h2><div class="wrap-body">
<p><a href="license">MIT</a> © <a href="https://wooorm.com">Titus Wormer</a></p>
<!-- Definitions -->
</div></div><div class="h2wrap-body"></div></div></div></div><footer class="footer-wrap"><footer class="max-container">© 2022 Kenny Wang.</footer></footer><script>
if(('onhashchange' in window) && ((typeof document.documentMode==='undefined') || document.documentMode==8)) {
  window.onhashchange = function () {
    anchorPoint()
    updateAnchor()
  };
}
function anchorPoint() {
  const hash = window.location.hash?.replace(/^#/, '') || '';
  const elm = document.getElementById(decodeURIComponent(hash));
  Array.from(document.querySelectorAll('.h2wrap-body .wrap')).forEach((elm) => elm.classList.remove('active'))
  if (elm?.tagName === 'H3') {
    elm?.parentElement?.parentElement?.classList.add('active');
  }
}
anchorPoint();

function updateAnchor(element) {
  const anchorContainer = document.querySelectorAll('.menu-tocs .menu-modal a.tocs-link');
  anchorContainer.forEach((tocanchor) => {
    tocanchor.classList.remove('is-active-link');
  });
  const anchor = element || document.querySelector(`a.tocs-link[href='${decodeURIComponent(window.location.hash)}']`);
  if (anchor) {
    anchor.classList.add('is-active-link');
  }
}
// toc 定位
updateAnchor()
const anchor = document.querySelectorAll('.menu-tocs .menu-modal a.tocs-link');
anchor.forEach((item) => {
  item.addEventListener('click', (e) => {
    updateAnchor()
  })
})
</script></body>
</html>
